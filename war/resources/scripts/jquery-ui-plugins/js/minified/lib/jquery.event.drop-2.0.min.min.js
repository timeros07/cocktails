/* 
 * jquery.event.drop - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function(e){e.fn.drop=function(j,b,i){var f=typeof j=="string"?j:"",h=e.isFunction(j)?j:e.isFunction(b)?b:null;if(f.indexOf("drop")!==0){f="drop"+f;
}i=(j==h?b:i)||{};return h?this.bind(f,i,h):this.trigger(f);};e.drop=function(b){b=b||{};a.multi=b.multi===true?Infinity:b.multi===false?1:!isNaN(b.multi)?b.multi:a.multi;a.delay=b.delay||a.delay;a.tolerance=e.isFunction(b.tolerance)?b.tolerance:b.tolerance===null?null:a.tolerance;a.mode=b.mode||a.mode||"intersect";
};var c=e.event,d=c.special,a=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",livekey:"livedrop",add:function(f){var b=e.data(this,a.datakey);b.related+=1;if(!b.live&&f.selector){b.live=true;c.add(this,"dropinit."+a.livekey,a.delegate);}},remove:function(){e.data(this,a.datakey).related-=1;
},setup:function(){if(!e.data(this,a.datakey)){e.data(this,a.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}});a.targets.push(this);}},teardown:function(){if(!e.data(this,a.datakey).related){e.removeData(this,a.datakey);c.remove(this,"dropinit",a.delegate);var b=this;a.targets=e.grep(a.targets,function(f){return f!==b;
});}},handler:function(g,b){var f;if(b){switch(g.type){case"mousedown":f=e(a.targets);if(typeof b.drop=="string"){f=f.filter(b.drop);}f.each(function(){var h=e.data(this,a.datakey);h.active=[];h.anyactive=0;h.winner=0;});b.droppable=f;a.delegates=[];d.drag.hijack(g,"dropinit",b);a.delegates=e.unique(d.drag.flatten(a.delegates));
break;case"mousemove":a.event=g;a.timer||a.tolerate(b);break;case"mouseup":a.timer=clearTimeout(a.timer);if(b.propagates){d.drag.hijack(g,"drop",b);d.drag.hijack(g,"dropend",b);e.each(a.delegates||[],function(){c.remove(this,"."+a.livekey);});}break;}}},delegate:function(i){var b=[],h,f=e.data(this,"events")||{};
e.each(f.live||[],function(j,g){if(g.preType.indexOf("drop")===0){h=e(i.currentTarget).find(g.selector);h.length&&h.each(function(){c.add(this,g.origType+"."+a.livekey,g.origHandler,g.data);e.inArray(this,b)<0&&b.push(this);});}});a.delegates.push(b);return b.length?e(b):false;},locate:function(l,b){var k=e.data(l,a.datakey),i=e(l),j=i.offset()||{},f=i.outerHeight();
i=i.outerWidth();j={elem:l,width:i,height:f,top:j.top,left:j.left,right:j.left+i,bottom:j.top+f};if(k){k.location=j;k.index=b;k.elem=l;}return j;},contains:function(f,b){return(b[0]||b.left)>=f.left&&(b[0]||b.right)<=f.right&&(b[1]||b.top)>=f.top&&(b[1]||b.bottom)<=f.bottom;},modes:{intersect:function(g,b,f){return this.contains(f,[g.pageX,g.pageY])?1000000000:this.modes.overlap.apply(this,arguments);
},overlap:function(g,b,f){return Math.max(0,Math.min(f.bottom,b.bottom)-Math.max(f.top,b.top))*Math.max(0,Math.min(f.right,b.right)-Math.max(f.left,b.left));},fit:function(g,b,f){return this.contains(f,b)?1:0;},middle:function(g,b,f){return this.contains(f,[b.left+b.width*0.5,b.top+b.height*0.5])?1:0;
}},sort:function(f,b){return b.winner-f.winner||f.index-b.index;},tolerate:function(w){var x,v,t,u,s,l,r=0,q,b=w.interactions.length,i=[a.event.pageX,a.event.pageY],f=a.tolerance||a.modes[a.mode];do{if(q=w.interactions[r]){if(!q){return;}q.drop=[];s=[];l=q.droppable.length;if(f){t=a.locate(q.proxy);}x=0;
do{if(v=q.droppable[x]){u=e.data(v,a.datakey);if(v=u.location){u.winner=f?f.call(a,a.event,t,v):a.contains(v,i)?1:0;s.push(u);}}}while(++x<l);s.sort(a.sort);x=0;do{if(u=s[x]){if(u.winner&&q.drop.length<a.multi){if(!u.active[r]&&!u.anyactive){if(d.drag.hijack(a.event,"dropstart",w,r,u.elem)[0]!==false){u.active[r]=1;
u.anyactive+=1;}else{u.winner=0;}}u.winner&&q.drop.push(u.elem);}else{if(u.active[r]&&u.anyactive==1){d.drag.hijack(a.event,"dropend",w,r,u.elem);u.active[r]=0;u.anyactive-=1;}}}}while(++x<l);}}while(++r<b);if(a.last&&i[0]==a.last.pageX&&i[1]==a.last.pageY){delete a.timer;}else{a.timer=setTimeout(function(){a.tolerate(w);
},a.delay);}a.last=a.event;}};d.dropinit=d.dropstart=d.dropend=a;})(jQuery);