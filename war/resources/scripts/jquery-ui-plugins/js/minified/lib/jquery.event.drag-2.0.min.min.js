/* 
 * jquery.event.drag - v 2.0.0 
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function(d){d.fn.drag=function(c,f,i){var h=typeof c=="string"?c:"",g=d.isFunction(c)?c:d.isFunction(f)?f:null;if(h.indexOf("drag")!==0){h="drag"+h;
}i=(c==g?f:i)||{};return g?this.bind(h,i,g):this.trigger(h);};var a=d.event,b=a.special,e=b.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",livekey:"livedrag",add:function(c){var f=d.data(this,e.datakey),g=c.data||{};f.related+=1;if(!f.live&&c.selector){f.live=true;
a.add(this,"draginit."+e.livekey,e.delegate);}d.each(e.defaults,function(h){if(g[h]!==undefined){f[h]=g[h];}});},remove:function(){d.data(this,e.datakey).related-=1;},setup:function(){if(!d.data(this,e.datakey)){var c=d.extend({related:0},e.defaults);d.data(this,e.datakey,c);a.add(this,"mousedown",e.init,c);
this.attachEvent&&this.attachEvent("ondragstart",e.dontstart);}},teardown:function(){if(!d.data(this,e.datakey).related){d.removeData(this,e.datakey);a.remove(this,"mousedown",e.init);a.remove(this,"draginit",e.delegate);e.textselect(true);this.detachEvent&&this.detachEvent("ondragstart",e.dontstart);
}},init:function(c){var f=c.data,g;if(!(f.which>0&&c.which!=f.which)){if(!d(c.target).is(f.not)){if(!(f.handle&&!d(c.target).closest(f.handle,c.currentTarget).length)){f.propagates=1;f.interactions=[e.interaction(this,f)];f.target=c.target;f.pageX=c.pageX;f.pageY=c.pageY;f.dragging=null;g=e.hijack(c,"draginit",f);
if(f.propagates){if((g=e.flatten(g))&&g.length){f.interactions=[];d.each(g,function(){f.interactions.push(e.interaction(this,f));});}f.propagates=f.interactions.length;f.drop!==false&&b.drop&&b.drop.handler(c,f);e.textselect(false);a.add(document,"mousemove mouseup",e.handler,f);return false;}}}}},interaction:function(c,f){return{drag:c,callback:new e.callback,droppable:[],offset:d(c)[f.relative?"position":"offset"]()||{top:0,left:0}};
},handler:function(c){var f=c.data;switch(c.type){case !f.dragging&&"mousemove":if(Math.pow(c.pageX-f.pageX,2)+Math.pow(c.pageY-f.pageY,2)<Math.pow(f.distance,2)){break;}c.target=f.target;e.hijack(c,"dragstart",f);if(f.propagates){f.dragging=true;}case"mousemove":if(f.dragging){e.hijack(c,"drag",f);if(f.propagates){f.drop!==false&&b.drop&&b.drop.handler(c,f);
break;}c.type="mouseup";}case"mouseup":a.remove(document,"mousemove mouseup",e.handler);if(f.dragging){f.drop!==false&&b.drop&&b.drop.handler(c,f);e.hijack(c,"dragend",f);}e.textselect(true);if(f.click===false&&f.dragging){jQuery.event.triggered=true;setTimeout(function(){jQuery.event.triggered=false;
},20);f.dragging=false;}break;}},delegate:function(c){var f=[],h,g=d.data(this,"events")||{};d.each(g.live||[],function(i,l){if(l.preType.indexOf("drag")===0){if(h=d(c.target).closest(l.selector,c.currentTarget)[0]){a.add(h,l.origType+"."+e.livekey,l.origHandler,l.data);d.inArray(h,f)<0&&f.push(h);}}});
if(!f.length){return false;}return d(f).bind("dragend."+e.livekey,function(){a.remove(this,"."+e.livekey);});},hijack:function(u,v,t,s,p){if(t){var q={event:u.originalEvent,type:u.type},f=v.indexOf("drop")?"drag":"drop",i,c=s||0,r,h;s=!isNaN(s)?s:t.interactions.length;u.type=v;u.originalEvent=null;t.results=[];
do{if(r=t.interactions[c]){if(!(v!=="dragend"&&r.cancelled)){h=e.properties(u,t,r);r.results=[];d(p||r[f]||t.droppable).each(function(g,j){i=(h.target=j)?a.handle.call(j,u,h):null;if(i===false){if(f=="drag"){r.cancelled=true;t.propagates-=1;}if(v=="drop"){r[f][g]=null;}}else{if(v=="dropinit"){r.droppable.push(e.element(i)||j);
}}if(v=="dragstart"){r.proxy=d(e.element(i)||r.drag)[0];}r.results.push(i);delete u.result;if(v!=="dropinit"){return i;}});t.results[c]=e.flatten(r.results);if(v=="dropinit"){r.droppable=e.flatten(r.droppable);}v=="dragstart"&&!r.cancelled&&h.update();}}}while(++c<s);u.type=q.type;u.originalEvent=q.event;
return e.flatten(t.results);}},properties:function(c,f,h){var g=h.callback;g.drag=h.drag;g.proxy=h.proxy||h.drag;g.startX=f.pageX;g.startY=f.pageY;g.deltaX=c.pageX-f.pageX;g.deltaY=c.pageY-f.pageY;g.originalX=h.offset.left;g.originalY=h.offset.top;g.offsetX=c.pageX-(f.pageX-g.originalX);g.offsetY=c.pageY-(f.pageY-g.originalY);
g.drop=e.flatten((h.drop||[]).slice());g.available=e.flatten((h.droppable||[]).slice());return g;},element:function(c){if(c&&(c.jquery||c.nodeType==1)){return c;}},flatten:function(c){return d.map(c,function(f){return f&&f.jquery?d.makeArray(f):f&&f.length?e.flatten(f):f;});},textselect:function(c){d(document)[c?"unbind":"bind"]("selectstart",e.dontstart).attr("unselectable",c?"off":"on").css("MozUserSelect",c?"":"none");
},dontstart:function(){return false;},callback:function(){}};e.callback.prototype={update:function(){b.drop&&this.available.length&&d.each(this.available,function(c){b.drop.locate(this,c);});}};b.draginit=b.dragstart=b.dragend=e;})(jQuery);