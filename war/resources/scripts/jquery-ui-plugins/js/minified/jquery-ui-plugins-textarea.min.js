(function(a,b){a.widget("uiplugins.textarea",{options:{"maxChars":-1,"charLimitMessage":"","pasteFlickerFix":true,"limitMessageStyle":{},"limitMessageClass":""},_create:function(){var c=this.options,d=this.element;d.addClass("ui-textarea");this.$textarea=d;if(c.maxChars&&c.charLimitMessage){this._renderLimitMessage();
}if(typeof c.maxChars==="function"||Number(c.maxChars)>=0){this._initCharLimit();}},_setOption:function(c,e){a.Widget.prototype._setOption.apply(this,arguments);var d=this.options;switch(c){case"maxChars":this._setMaxChars(e);break;case"charLimitMessage":if(e){this.refresh();}break;case"limitMessageStyle":if(typeof d.limitMessageStyle==="string"){d.limitMessageStyle=a.parseJSON(d.limitMessageStyle);
}this.$limitMessage.css(d.limitMessageStyle);break;case"limitMessageClass":d.limitMessageClass+=" ui-char-limit-message";this.$limitMessage.attr("class",d.limitMessageClass);break;}},_renderLimitMessage:function(){var e=this.$textarea;var d=this.options;var c=a('<div class="ui-char-limit-message"></div>').insertAfter(e);
c.css(d.limitMessageStyle);c.addClass(d.limitMessageClass);e.parent("div").css("margin-bottom",c.height()+"px");this.$limitMessage=c;},_getLimitMessageLoc:function(){var d=this.$textarea;var c=d.offset();c.top+=a.browser.msie?d.height()+7:d.height()+3;c.left+=2;return c;},_handleKeyPress:function(d){this._trigger("beforeChange",d,this.element);
var k=this;var c=this.options;var g=typeof c.maxChars==="function"?c.maxChars.apply():c.maxChars;var i=d.which;var h=k._getValueData();var e=h.beforeCursor+String.fromCharCode(i)+this.afterCursor();var f=(i>=a.ui.keyCode.SHIFT&&i<=a.ui.keyCode.CAPS_LOCK)||i==a.ui.keyCode.ESCAPE||(i>a.ui.keyCode.SPACE&&i<=a.ui.keyCode.DOWN)||i==a.ui.keyCode.INSERT||(i>=a.ui.keyCode.COMMAND&&i<=a.ui.keyCode.COMMAND_RIGHT)||(i>=a.ui.keyCode.NUM_LOCK&&i<=a.ui.keyCode.SCROLL_LOCK);
var j=i==0||i==a.ui.keyCode.BACKSPACE||i==a.ui.keyCode.DELETE||(d.ctrlKey&&i==a.ui.keyCode.A);if(!(f||j)){if(e.length>g){return false;}}if(!f){setTimeout(function(){k._trigger("afterChange",d,k.element);},0);}},_handlePaste:function(h){this._trigger("beforeChange",h,this.element);var f=this;var e=f._getValueData();
var g=f.options;var c=typeof g.maxChars==="function"?g.maxChars.apply():g.maxChars;var j=f.$textarea;var i=null;if(g.pasteFlickerFix&&g.pasteFlickerFix!=="false"){var d=f._getPasteFixLocation();i=a('<textarea rows="'+j.attr("rows")+'" cols="'+j.attr("cols")+'"></textarea>').addClass(j.attr("class")).css({"position":"absolute","top":d.top,"left":d.left}).insertAfter(j).val(e.text);
}setTimeout(function(){var k=j.val();var m=k.substring(e.beforeCursor.length,k.length-e.afterCursor.length);if(k.length>c){var l=m.substring(0,c-e.beforeCursor.length-e.afterCursor.length);j.val(e.beforeCursor+l+e.afterCursor);}j.caret({"start":e.beforeCursor.length,"end":f._getValueData().text.length-e.afterCursor.length});
if(i){i.remove();}f.refresh(h);f._trigger("afterChange",h,f.element);},0);},_getPasteFixLocation:function(){var c=this.$textarea.offset();if(a.browser.webkit){c.top-=2;c.left-=2;}else{if(a.browser.mozilla){c.top-=1;}}return c;},_showCharLimitMessage:function(){var d=this.options;var g=this.$textarea;
var c=typeof d.maxChars==="function"?d.maxChars.apply():d.maxChars;var e=g.val().length;var f=d.charLimitMessage.replace("{MAX}",c).replace("{ENTERED}",e).replace("{REMAINING}",c-e);g.next("div.ui-char-limit-message").text(f);},_setMaxChars:function(c){var e=this.$textarea;var d=e.val();if(d.length>Number(c)){e.val(d.substring(0,c));
}this.refresh();},_initCharLimit:function(){var c=this;var d=c.options;var e=c.$textarea;e.keydown(function(f){return c._handleKeyPress(f);});e.bind("paste",function(f){c._handlePaste(f);});if(d.charLimitMessage){c._showCharLimitMessage();e.keyup(function(g){var f=g.which;if(!c._ignoreKeyPress(f)){c.refresh(g);
}});}},_getValueData:function(){var e=this.$textarea;var c=e.caret();var d=e.val();return{"selection":c,"text":d,"beforeCursor":d.substring(0,c.start),"afterCursor":d.substring(c.end)};},_ignoreKeyPress:function(c){return c==a.ui.keyCode.ALT||c==a.ui.keyCode.CAPS_LOCK||c==a.ui.keyCode.COMMAND||c==a.ui.keyCode.COMMAND_LEFT||c==a.ui.keyCode.COMMAND_RIGHT||c==a.ui.keyCode.CONTROL||c==a.ui.keyCode.DOWN||c==a.ui.keyCode.END||c==a.ui.keyCode.ESCAPE||c==a.ui.keyCode.HOME||c==a.ui.keyCode.INSERT||c==a.ui.keyCode.LEFT||c==a.ui.keyCode.PAGE_DOWN||c==a.ui.keyCode.PAGE_UP||c==a.ui.keyCode.RIGHT||c==a.ui.keyCode.SHIFT||c==a.ui.keyCode.UP;
},refresh:function(c){this._showCharLimitMessage();},selectedText:function(d,c){if(a.isNumeric(d)&&a.isNumeric(c)){this.$textarea.caret({"start":Number(d),"end":Number(c)});}else{return this.$textarea.caret().text;}},selectionStart:function(){return this.$textarea.caret().start;},selectionEnd:function(){return this.$textarea.caret().end;
},replaceSelection:function(d){var c=this.$textarea.caret();if(c.start!=c.end){this.$textarea.val(c.replace(d));this.selectedText(c.start,c.start+d.length);this.refresh();}},beforeCursor:function(){return this._getValueData().beforeCursor;},afterCursor:function(){return this._getValueData().afterCursor;
},remaining:function(){var d=this.options;var c=typeof d.maxChars==="function"?d.maxChars.apply():d.maxChars;var e=this.$textarea.val().length;return c-e;},enable:function(){this.element.removeAttr("disabled");a.Widget.prototype.enable.call(this);this._trigger("enable",null,this.element);},disable:function(){this.element.attr("disabled","disabled");
a.Widget.prototype.disable.call(this);this._trigger("disable",null,this.element);},destroy:function(){var c=this.$textarea;c.unbind();c.removeClass("ui-textarea");if(this.options.charLimitMessage){c.next(".ui-char-limit-message").remove();}a.Widget.prototype.destroy.call(this);}});})(jQuery);(function(c,a,b,d){c.fn.caret=function(u,o){var f,i,q=this[0],k=c.browser.msie,r,m;
if(typeof u==="object"&&typeof u.start==="number"&&typeof u.end==="number"){f=u.start;i=u.end;}else{if(typeof u==="number"&&typeof o==="number"){f=u;i=o;}else{if(typeof u==="string"){if((f=q.value.indexOf(u))>-1){i=f+u[a];}else{f=null;}}else{if(Object.prototype.toString.call(u)==="[object RegExp]"){var p=u.exec(q.value);
if(p!=null){f=p.index;i=f+p[0][a];}}}}}if(typeof f!="undefined"){if(k){var l=this[0].createTextRange();l.collapse(true);l.moveStart("character",f);l.moveEnd("character",i-f);l.select();}else{this[0].selectionStart=f;this[0].selectionEnd=i;}this[0].focus();return this;}else{if(k){var n=document.selection;
if(this[0].tagName.toLowerCase()!="textarea"){var g=this.val(),j=n[b]()[d]();j.moveEnd("character",g[a]);r=(j.text==""?g[a]:g.lastIndexOf(j.text));j=n[b]()[d]();j.moveStart("character",-g[a]);m=j.text[a];}else{j=n[b](),stored_range=j[d]();stored_range.moveToElementText(this[0]);stored_range.setEndPoint("EndToEnd",j);
r=stored_range.text[a]-j.text[a],m=r+j.text[a];}}else{r=q.selectionStart,m=q.selectionEnd;}var h=q.value.substring(r,m);return{start:r,end:m,text:h,replace:function(s){var e=q.value.substring(0,r)+s+q.value.substring(m,q.value[a]);return e;}};}};})(jQuery,"length","createRange","duplicate");