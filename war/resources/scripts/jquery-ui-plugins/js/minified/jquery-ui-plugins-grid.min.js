(function(a,b){a.widget("uiplugins.grid",{options:{rowKey:"id",calendarImage:"http://jquery-ui-plugins.googlecode.com/svn/trunk/examples/images/calendar.png"},slickMethods:["addCellCssStyles","autosizeColumns","canCellBeActive","canCellBeSelected","editActiveCell","flashCell","focus","getActiveCell","getActiveCellNode","getActiveCellPosition","getCanvasNode","getCellCssStyles","getCellEditor","getCellFromEvent","getCellFromPoint","getCellNode","getCellNodeBox","getColumnIndex","getColumns","getData","getDataItem","getDataLength","getEditController","getEditorLock","getGridPosition","getHeaderRow","getHeaderRowColumn","getOptions","getRenderedRange","getSelectedRows","getSelectionModel","getSortColumns","getTopPanel","getViewport","gotoCell","init","invalidate","invalidateAllRows","invalidateRow","invalidateRows","navigateDown","navigateLeft","navigateNext","navigatePrev","navigateRight","navigateUp","registerPlugin","removeCellCssStyles","render","resetActiveCell","resizeCanvas","scrollCellIntoView","scrollRowIntoView","scrollRowToTop","setActiveCell","setCellCssStyles","setColumns","setData","setHeaderRowVisibility","setOptions","setSelectedRows","setSelectionModel","setSortColumn","setSortColumns","setTopPanelVisibility","unregisterPlugin","updateCell","updateColumnHeader","updateRow","updateRowCount"],slickEvents:["onActiveCellChanged","onActiveCellPositionChanged","onAddNewRow","onBeforeCellEditorDestroy","onBeforeDestroy","onBeforeEditCell","onCellChange","onCellCssStylesChanged","onClick","onColumnsReordered","onColumnsResized","onContextMenu","onDblClick","onDrag","onDragEnd","onDragInit","onDragStart","onHeaderClick","onHeaderContextMenu","onKeyDown","onMouseEnter","onMouseLeave","onScroll","onSelectedRowsChanged","onSort","onValidationError","onViewportChanged"],filterValues:{"numericDialog":[{"name":"Equal To","value":"eq"},{"name":"Not Equal To","value":"neq"},{"name":"Greater Than","value":"gt"},{"name":"Greater Than OR Equal To","value":"gte"},{"name":"Less Than","value":"lt"},{"name":"Less Than OR Equal To","value":"lte"}],"dateDialog":[{"name":"On","value":"eq"},{"name":"Before","value":"lt"},{"name":"After","value":"gt"}],"date":[{"name":"Today","value":"today"},{"name":"Tomorrow","value":"tomorrow"},{"name":"Yesterday","value":"yesterday"},{"name":"This Week","value":"thisweek"},{"name":"Next Week","value":"nextweek"},{"name":"Last Week","value":"lastweek"},{"name":"This Month","value":"thismonth"},{"name":"Next Month","value":"nextmonth"},{"name":"Last Month","value":"lastmonth"},{"name":"This Year","value":"thisyear"},{"name":"Next Year","value":"nextyear"},{"name":"Last Year","value":"lastyear"}]},logicOperators:[{"name":"And","value":"and"},{"name":"Or","value":"or"}],operators:{"gt":function(d,c){return +d>+c;
},"gte":function(d,c){return +d>=+c;},"lt":function(d,c){return +d<+c;},"lte":function(d,c){return +d<=+c;},"eq":function(d,c){return +d==+c;},"neq":function(d,c){return +d!=+c;},"and":function(d,c){return d&&c;},"or":function(d,c){return d||c;}},formatDefaults:{"checkbox":{"checkedValue":"true","notCheckedValue":"false"},"currency":{"region":"USD","thousands":",","decimal":".","decimals":2},},cssStyleHash:{},_create:function(){var c=this,e=this.options,f=this.dataView=new Slick.Data.DataView();
this.dataHash=this._initDataHash();this.dateInfo=this._initDateInfo();this.element.addClass("ui-grid");this.options.editDisabled=this.options.editable;this._initColumns();e.showHeaderRow=this.filters?true:e.showHeaderRow;var d=this.grid=new Slick.Grid(this.element,this.dataView,e.columns,e);this.options=d.getOptions();
if(this.filters){this._renderFilters();this._bindFilterEvents();}this._initSlickMethods();this._initEventHandlers();this._initSelectionModel();d.onSort.subscribe(function(h,g){sortCol=g.sortCol;c.dataView.sort(c.sortFunctions[sortCol.id],g.sortAsc);if(c.options.selectionModel){c.dataView.syncGridSelection(d,true);
}d.invalidate();});d.onColumnsReordered.subscribe(function(){c._renderFilters();});d.onColumnsResized.subscribe(function(){c._renderFilters();});f.getItemMetadata=function(i){var g={};var h=this.getItem(i);if(h&&h.cssClasses){g.cssClasses=h.cssClasses;}return g;};f.beginUpdate();f.setItems(e.data,e.rowKey);
f.endUpdate();d.invalidate();},_initColumns:function(){this.columns={};this.originalColumnDefs=[];for(var f=0;f<this.options.columns.length;f++){this.originalColumnDefs[f]=a.extend(true,{},this.options.columns[f]);}var e=this.options.columns;for(var f=0;f<e.length;f++){var d=e[f];d.headerCssClass+=" ui-grid-header";
this.columns[d.id]=d;this._initSorting(d);this._initFiltering(d);this._initEditing(d);this._initFormatting(d);}if(this.filters){var c=this;this.dataView.setFilter(function(g){return c._filter(g);});}},_initSorting:function(c,d){if(c.sort!==false){if(!this.sortFunctions){this.sortFunctions={};}c.sortable=true;
c.headerCssClass+=c.headerCssClass+" ui-grid-sortable";if(typeof c.sort==="function"){this.sortFunctions[c.id]=c.sort;}else{if(c.sort==="date"&&c.dateFormat){this._initDateSort(c);this.sortFunctions[c.id]=this._dateSort;}else{if(c.dataType==="numeric"||c.dataType==="integer"||c.sort==="numeric"||c.sort==="integer"){this.sortFunctions[c.id]=this._numericSort;
}else{this.sortFunctions[c.id]=this._sort;}}}}},_initFiltering:function(d){if(d.filter){if(!this.filters){this.filters={};}var f=(typeof d.filter==="object"&&d.filter.type==="list")||a.isArray(d.filter);var g=f&&!d.filterDefault?"$NO_FILTER$":d.filterDefault;if(d.filter.impl){this.filters[d.id]=a.extend(d.filter,{"type":"custom","value":g});
}else{var e=f?"list":d.filter;var c=null;if(f){c=d.filter.options?d.filter.options:d.filter;}this.filters[d.id]={"type":e,"value":g,"options":c,"dataItemAttribute":d.filter.dataItemAttribute};}}},_initEditing:function(c){if(c.editor){if(typeof c.editor!=="function"){var d=c.editor;var e=a.isArray(d);
if(d==="list"||e){c.editor=this._dropDownEdit;c.editorOptions=e?d:c.editorOptions;}else{if(d==="date"){c.editor=this._dateEdit;}else{c.editor=this._textEdit;c.dataType=d;}}}}},_initFormatting:function(e){var d=[];if(e.formatter){if(typeof e.formatter==="function"){d.push(e.formatter);}else{if(typeof e.formatter==="string"){e.formatOptions=a.extend({"type":e.formatter},this.formatDefaults[e.formatter]);
}else{if(typeof e.formatter==="object"&&e.formatter.type){e.formatOptions=a.extend({},this.formatDefaults[e.formatter.type],e.formatter);}}switch(e.formatOptions.type){case"checkbox":d.push(this._checkboxFormatter);this.hasCheckboxes=true;break;case"currency":d.push(this._currencyFormatter);break;case"properCase":d.push(this._properCaseFormatter);
break;}}}else{if(this.options.formatterFactory&&this.options.formatterFactory.getFormatter(e)){d.push(this.options.formatterFactory.getFormatter(e));}}d.push(this._addCellCssFormatter);if(d.length>0){var c=this;e.formatters=d;e.formatter=function(j,i,g,f,h){return c._formatterChain.call(this,j,i,g,f,h,c);
};}},_initDataHash:function(){var d={};var f=this.options.rowKey;for(var c=0;c<this.options.data.length;c++){var e=this.options.data[c];d[e[f]]=e;}return d;},_initDateInfo:function(){var c=Date.today().clearTime();return{"today":c.getTime(),"tomorrow":Date.today().addDays(1).getTime(),"yesterday":Date.today().addDays(-1).getTime(),"sunday":c.getDay()==0?c.clone():Date.today().moveToDayOfWeek(0,-1).getTime(),"lastSunday":c.getDay()==0?Date.today().moveToDayOfWeek(0,-1).getTime():Date.today().moveToDayOfWeek(0,-1).moveToDayOfWeek(0,-1).getTime(),"nextSunday":Date.today().moveToDayOfWeek(0).getTime(),"dayMillis":60*60*24*1000,"weekMillis":60*60*24*7*1000,"lastMonthStart":Date.today().moveToFirstDayOfMonth().addDays(-1).moveToFirstDayOfMonth().getTime(),"thisMonthStart":Date.today().moveToFirstDayOfMonth().getTime(),"nextMonthStart":Date.today().moveToLastDayOfMonth().addDays(1).getTime(),"nextMonthEnd":Date.today().moveToLastDayOfMonth().addDays(1).moveToLastDayOfMonth().addDays(1).getTime(),"lastYearStart":Date.today().set({day:1,month:0,year:c.getFullYear()-1}).getTime(),"thisYearStart":Date.today().set({day:1,month:0}).getTime(),"nextYearStart":Date.today().set({day:1,month:0,year:c.getFullYear()+1}).getTime(),"nextYearEnd":Date.today().set({day:1,month:0,year:c.getFullYear()+2}).getTime()};
},_initDateSort:function(d){var e=this.option("data");for(var c=0;c<e.length;c++){var f=e[c];f[d.field+"-sort"]=Date.parseExact(f[d.field],d.dateFormat).getTime();}},_initSlickMethods:function(){for(var d=0;d<this.slickMethods.length;d++){var c=this.slickMethods[d];switch(c){case"getData":this[c]=function(){return this.options.data;
};this["getDataView"]=this.grid[c];break;case"setData":this[c]=function(e){this.options.data=e;this.dataHash=this._initDataHash();this.grid.setData(e);this.grid.invalidate();};break;case"getColumns":this[c]=function(){return this.originalColumnDefs;};break;case"setColumns":this[c]=function(e){this.options.columns=e;
this._initColumns();this.grid.setColumns(this.options.columns);this.grid.render();this._renderFilters();};break;default:this[c]=this.grid[c];}}},_initEventHandlers:function(){for(var d=0;d<this.slickMethods.length;d++){var c=this.slickEvents[d];this._bindEventHandler(c,this.options[c]);}if(this.hasCheckboxes){this._bindCheckboxHandler();
}},_initSelectionModel:function(){var c=this.options.selectionModel;if(c){if(typeof c==="string"){switch(c){case"row":c=new Slick.RowSelectionModel({selectActiveRow:this.options.selectActiveRow});break;case"cell":c=new Slick.CellSelectionModel({selectActiveCell:this.options.selectActiveCell});break;}}this.grid.setSelectionModel(c);
}},_bindCheckboxHandler:function(){var c=this;var d=this.grid;this.element.on("click","input.ui-grid-checkbox",function(l){var h=d.getActiveCell();var j=d.getDataItem(h.row);var g=d.getColumns()[h.cell];var i=a(this);j[g.field]=i.is(":checked")?g.formatOptions.checkedValue:g.formatOptions.notCheckedValue;
var k=i.parent("div");k.toggleClass("ui-changed-cell");if(k.hasClass("ui-changed-cell")){var m={};var f=j[g.field]===g.formatOptions.checkedValue?g.formatOptions.notCheckedValue:g.formatOptions.checkedValue;m[g.field]=f;a.extend(true,j,{"changedCells":m});}else{delete j.changedCells[g.field];}c._slickGridTrigger(d.onCellChange,{row:h.row,cell:h.cell,item:j});
});},_slickGridTrigger:function(c,d,f){f=f||new Slick.EventData();d=d||{};d.grid=self;return c.notify(d,f,self);},_bindEventHandler:function(c,d){if(d){this.grid[c].subscribe(d);}},_sort:function(e,d){var f=e[sortCol.field],c=d[sortCol.field];return(f==c?0:(f>c?1:-1));},_numericSort:function(e,d){var f=+e[sortCol.field],c=+d[sortCol.field];
return(f==c?0:(f>c?1:-1));},_dateSort:function(e,d){var f=e[sortCol.field+"-sort"],c=d[sortCol.field+"-sort"];return(f==c?0:(f>c?1:-1));},_renderFilters:function(){var l=this;var c=this.grid;var h=c.getColumns();for(var j=0;j<h.length;j++){var g=h[j];var f=l.filters[g.id];if(f){var d=a(c.getHeaderRowColumn(g.id)).empty();
var e="ui-grid-filter-"+g.id;var k=f.value?f.value:"";if(f.options){l._renderDropDownFilter(e,d,g,f.options);}else{if(f.type==="numeric"){l._renderTextFilter(e,d,g,k).width(d.width()-24).css("float","left").textinput({"filter":"numeric"});l._renderFilterButton(f.type,g,d);}else{if(f.type==="date"){l._renderDropDownFilter(e,d,g,l.filterValues[f.type]).width(d.width()-20).css("float","left");
l._renderFilterButton(f.type,g,d);}else{l._renderTextFilter(e,d,g,k);}}}}}},_renderFilterButton:function(e,d,c){a('<span class="ui-filter-button"/>').appendTo(c).data({"columnId":d.id,"type":e});},_renderTextFilter:function(g,d,e,f){var c=this;return a('<input type="text" class="ui-grid-filter '+g+'" value="'+f+'">').appendTo(d).data("columnId",e.id).width(d.width()-4).height(d.height()-12).click(function(){c.saveCurrentEdit();
a(this).focus();});},_renderDropDownFilter:function(e,c,g,p){var o=this;var k='<select class="ui-grid-filter '+e+'">';k+='<option value="$NO_FILTER$"></option>';var f=this.filters[g.id];var l=f.value;for(var h=0;h<p.length;h++){var j=p[h];var n=typeof j==="object";var m=n?j.value:j;var d=n?j.name:j;k+='<option value="'+m+'"'+(m===l?"selected":"")+">"+d+"</option>";
}k+="</select>";return a(k).appendTo(c).data("columnId",g.id).width(c.width()-4).val(l).click(function(){o.saveCurrentEdit();a(this).focus();});},_renderFilterDialog:function(h,f){var g=a("#ui-grid-filter-dialog-"+h);if(g.length==0){var e='<div id="ui-grid-filter-dialog-'+h+'" style="display: none;" class="ui-grid-filter-dialog">';
e+='<div><label>Show rows where </label><label class="columnName"></label></div>';e+=this._getFilterHtml(f+"Dialog");e+="<div>";for(var d=0;d<this.logicOperators.length;d++){var c=this.logicOperators[d];e+='<input type="radio" name="logicOperator" class="ui-filter-logic-operator" value="'+c.value+'"/><label>'+c.name+"</label>";
}e+="</div>";e+=this._getFilterHtml(f+"Dialog");e+="</div>";g=a(e);}return g;},_getFilterHtml:function(f){var d='<div><select class="ui-filter-compare-operator">';var g=this.filterValues[f];for(var c=0;c<g.length;c++){var e=g[c];d+='<option value="'+e.value+'">'+e.name+"</option>";}d+='<input type="text" class="ui-filter-val'+(f.startsWith("date")?" ui-date-filter":"")+'"/>';
d+="</select>";d+="</div>";return d;},_bindFilterEvents:function(){var c=this;$headerRow=a(this.grid.getHeaderRow());$headerRow.on("change keyup","input, select",function(f){var d=a(this).data("columnId");c._filterColumn(d);});$headerRow.on("click","span.ui-filter-button",function(h){if(!c.disabled){var g=a(this);
var f=g.data("columnId");var d=g.data("type");c._showFilterDialog(a(this),f,d);}});},_showFilterDialog:function(j,i,f){var c=this;var h=this._renderFilterDialog(i,f);var e=this.columns[i];var g={"Cancel":function(){a(this).dialog("close");},"OK":function(){c._applyDialogFilter(h,e);}};if(this.filters[i].logic){g["Clear"]=function(){c._clearDialogFilter(h,i);
};}h.find("label.columnName").text(e.name+" is:");var d=h.find("input.ui-date-filter");d.datepicker({showOn:"button",buttonImageOnly:true,buttonImage:c.options.calendarImage,beforeShow:function(){a("#ui-datepicker-div").addClass("ui-grid-datepicker");},onClose:function(){a("#ui-datepicker-div").addClass("ui-grid-datepicker");
}});d.datepicker("option","buttonImage",c.options.calendarImage);h.keypress(function(k){if(k.keyCode==a.ui.keyCode.ENTER){c._applyDialogFilter(h,e);}});h.dialog({"title":(f.toProperCase()+" Filter"),"modal":true,"dialogClass":"ui-filter-dialog","buttons":g,"position":{my:"left top",at:"left bottom",of:j}}).show();
},_filterColumn:function(g){if(g){var e=this.filters[g];if(e.type==="numeric"||e.type==="date"){var f=a("#ui-grid-filter-dialog-"+g);var d=this.columns[g];var c={};c.comparisons=[];f.find("select.ui-filter-compare-operator").each(function(){var i=a(this);var h=i.next("input.ui-filter-val").val();if(h){h=e.type==="date"?Date.parseExact(h,d.dateFormat).getTime():h;
c.comparisons.push({"operator":i.val(),"value":h});}});c.logicOperator=f.find("input.ui-filter-logic-operator:checked").val();if(c.comparisons.length){e.logic=c;}}e.value=a.trim(a("#"+this.element.attr("id")+" .ui-grid-filter-"+g).val());this.dataView.refresh();this.grid.invalidate();}},_filter:function(j){var c=this.grid;
var f=this.filters;if(j&&f){var k=true;for(var d in f){var e=f[d];if((e&&e.value!==b&&e.value!=="$NO_FILTER$")||(e.logic)){var h=c.getColumns();var g=h[c.getColumnIndex(d)];if(g==null||g==b){continue;}var i=j[g.field];i=typeof i==="object"&&e.dataItemAttribute?i[e.dataItemAttribute]+"":i+"";if(i||i===""){switch(e.type){case"startsWith":k=i.toLowerCase().startsWith(e.value.toLowerCase());
break;case"endsWith":k=i.toLowerCase().endsWith(e.value.toLowerCase());break;case"contains":k=i.toLowerCase().indexOf(e.value.toLowerCase())>-1;break;case"doesNotContain":k=!e.value||i.toLowerCase().indexOf(e.value.toLowerCase())===-1;break;case"list":k=i===e.value;break;case"numeric":k=this._applyNumericFilter(e,i);
break;case"date":k=this._applyDateFilter(e,j[g.field+"-sort"]);break;case"custom":k=e.impl.call(e,e.value,i);break;}}if(!k){return k;}}}}return true;},_applyNumericFilter:function(d,j){var k=true;var e=d.logic;if(e&&e.comparisons.length>0){var h=e.comparisons[0];var g=e.comparisons[1];var c=e.logicOperator;
if(g&&c){var i=this.operators[h.operator](j,h.value);var f=this.operators[g.operator](j,g.value);k=this.operators[c](i,f);}else{k=this.operators[h.operator](j,h.value);}}if(d.value){k=k&&+j==+d.value;}return k;},_applyDateFilter:function(d,j){var k=true;j=+j;var e=d.logic;if(e&&e.comparisons.length>0){var h=e.comparisons[0];
var g=e.comparisons[1];var c=e.logicOperator;if(g&&c){var i=this.operators[h.operator](j,h.value);var f=this.operators[g.operator](j,g.value);k=this.operators[c](i,f);}else{k=this.operators[h.operator](j,h.value);}}if(d.value){switch(d.value){case"today":k=j>=this.dateInfo.today&&j<this.dateInfo.tomorrow;
break;case"tomorrow":k=j>=this.dateInfo.tomorrow&&j<this.dateInfo.tomorrow+this.dateInfo.dayMillis;break;case"yesterday":k=j>=this.dateInfo.yesterday&&j<this.dateInfo.today;break;case"thisweek":k=j>=this.dateInfo.sunday&&j<this.dateInfo.nextSunday;break;case"nextweek":k=j>=this.dateInfo.nextSunday&&j<this.dateInfo.nextSunday+this.dateInfo.weekMillis;
break;case"lastweek":k=j>=this.dateInfo.lastSunday&&j<this.dateInfo.sunday;break;case"thismonth":k=j>=this.dateInfo.thisMonthStart&&j<this.dateInfo.nextMonthStart;break;case"nextmonth":k=j>=this.dateInfo.nextMonthStart&&j<this.dateInfo.nextMonthEnd;break;case"lastmonth":k=j>=this.dateInfo.lastMonthStart&&j<this.dateInfo.thisMonthStart;
break;case"thisyear":k=j>=this.dateInfo.thisYearStart&&j<this.dateInfo.nextYearStart;break;case"nextyear":k=j>=this.dateInfo.nextYearStart&&j<this.dateInfo.nextYearEnd;break;case"lastyear":k=j>=this.dateInfo.lastYearStart&&j<this.dateInfo.thisYearStart;break;}}return k;},_applyDialogFilter:function(f,d){var c=this;
var e=d.id;this._filterColumn(e);this.grid.updateColumnHeader(e,d.name+'<span id="'+e+'_removeFilterButton" class="ui-remove-filter-button"></span>',"");a("#"+e+"_removeFilterButton").click(function(){c._clearDialogFilter(f,e);});f.dialog("close");},_clearDialogFilter:function(d,c){this.filters[c].logic=null;
d.find("select.ui-filter-compare-operator").val("");d.find("input.ui-filter-val").val("");d.find("input.ui-filter-logic-operator").removeAttr("checked");this._filterColumn(c);a("#"+c+"_removeFilterButton").remove();d.dialog("close");},_dateEdit:function(d){var f=null;var c=null;var e=false;this.init=function(){var h=a(d.container);
var g=h.padding("top");f=a('<input type="text" class="ui-grid-editor" />').appendTo(d.container).width(h.width()+h.padding("right")-(a.browser.msie||a.browser.mozilla?2:1)).height(h.height()-g-h.padding("bottom")).css({"position":"relative","top":-g,"left":-h.padding("left")}).focus().select();f.datepicker({showOn:"button",buttonImageOnly:true,buttonImage:d.grid.getOptions()["calendarImage"],beforeShow:function(){a("#ui-datepicker-div").addClass("ui-grid-datepicker");
e=true;},onClose:function(){a("#ui-datepicker-div").addClass("ui-grid-datepicker");e=false;}});f.width(f.width()-18);};this.destroy=function(){a.datepicker.dpDiv.stop(true,true);f.datepicker("hide");f.datepicker("destroy");f.remove();};this.show=function(){if(e){a.datepicker.dpDiv.stop(true,true).show();
}};this.hide=function(){if(e){a.datepicker.dpDiv.stop(true,true).hide();}};this.position=function(g){if(!e){return;}a.datepicker.dpDiv.css("top",g.top+30).css("left",g.left);};this.focus=function(){f.focus();};this.loadValue=function(g){c=g[d.column.field];f.val(c);f[0].defaultValue=c;f.select();};this.serializeValue=function(){return f.val();
};this.applyValue=function(h,i){var g=d.column;h[g.field]=i;if(g.sort==="date"&&g.dateFormat){h[g.field+"-sort"]=Date.parseExact(i,g.dateFormat).getTime();}};this.isValueChanged=function(){return a.uiplugins.grid.prototype._trackChange.call(this,f,c,d);};this.validate=function(){return{valid:true,msg:null};
};this.init();},_textEdit:function(d){var e=null;var c=null;this.init=function(){var g=a(d.container);var f=g.padding("top");e=a('<input type="text" class="ui-grid-editor"/>').appendTo(d.container).bind("keydown.nav",function(h){if(h.keyCode===a.ui.keyCode.LEFT||h.keyCode===a.ui.keyCode.RIGHT){h.stopImmediatePropagation();
}}).width(g.width()+g.padding("right")-(a.browser.msie||a.browser.mozilla?2:1)).height(g.height()-f-g.padding("bottom")).css({"position":"relative","top":-f,"left":-g.padding("left"),"text-align":g.css("text-align")}).focus().select();switch(d.column.dataType){case"integer":e.textinput({"filter":"digits"});
break;case"numeric":e.textinput({"filter":"numeric"});break;}};this.destroy=function(){e.remove();};this.focus=function(){e.focus();};this.getValue=function(){return e.val();};this.setValue=function(f){e.val(f);};this.loadValue=function(f){c=f[d.column.field]||"";e.val(c);e[0].defaultValue=c;e.select();
};this.serializeValue=function(){return e.val();};this.applyValue=function(f,g){f[d.column.field]=g;};this.isValueChanged=function(){return a.uiplugins.grid.prototype._trackChange.call(this,e,c,d);};this.validate=function(){if(d.column.validator){var f=d.column.validator(e.val());if(!f.valid){return f;
}}return{valid:true,msg:null};};this.init();},_dropDownEdit:function(e){var d=null;var c=null;this.init=function(){var l='<select tabIndex="0" class="ui-grid-editor">';var q=typeof e.column.editorOptions==="function"?e.column.editorOptions.call(this,e.item,e.column):e.column.editorOptions;var m=a(e.container);
var o=m.padding("top");var g=m.padding("left");for(var j=0;j<q.length;j++){var k=q[j];var p=typeof k==="object";var f=p?k.name:k;var n=p?k.value:k;var h=p&&k.disabled?' disabled="disabled"':"";l+='<option value="'+n+'"'+h+">"+f+"</option>";}l+="</select>";d=a(l).width(m.width()+m.padding("right")+g).height(m.height()+o+m.padding("bottom")).css({"position":"relative","top":-o,"left":-g,"text-align":m.css("text-align")}).appendTo(e.container).focus();
};this.destroy=function(){d.remove();};this.focus=function(){d.focus();};this.loadValue=function(f){d.val((c=f[e.column.field]||""));d.select();};this.serializeValue=function(){return d.val();};this.applyValue=function(f,g){f[e.column.field]=g;};this.isValueChanged=function(){return a.uiplugins.grid.prototype._trackChange.call(this,d,c,e);
};this.validate=function(){return{valid:true,msg:null};};this.init();},_trackChange:function(h,f,e){var l=e.item;var c=e.column.dataType==="numeric";var j=c?Number(h.val()):h.val();var k=(!(j==""&&f==null))&&(j!=f);var d=l.changedCells&&l.changedCells[e.column.field]!==b;if(k&&!d){var g={};g[e.column.field]=f;
a.extend(true,l,{"changedCells":g});}else{if(k&&d){var i=c?Number(l.changedCells[e.column.field]):l.changedCells[e.column.field];if(j===i){delete l.changedCells[e.column.field];}}}return k;},_currencyFormatter:function(g,f,d,c,e){if(a.currency){d=a.currency(d,c.formatOptions);}return d;},_checkboxFormatter:function(i,h,f,d,g,c){var e='<input type="checkbox" class="ui-grid-checkbox"';
if(f&&(f+"").toLowerCase()!==d.formatOptions.notCheckedValue.toLowerCase()){e+=' checked="checked"';}if(c.disabled){e+=' disabled="disabled"';}e+="/>";return e;},_properCaseFormatter:function(g,f,d,c,e){return d?d.toProperCase():"";},_addCellCssFormatter:function(g,f,d,c,e){html="<div";if(e.cellClasses&&e.cellClasses[c.field]!==b){html+=' class="'+e.cellClasses[c.field]+'"';
}html+=">"+d+"</div>";return html;},_formatterChain:function(j,g,k,f,m,l){var h=m.cellClasses?m.cellClasses:{};if(m.changedCells&&m.changedCells[f.field]!==b){h[f.field]=h[f.field]?h[f.field]+" ui-changed-cell":"ui-changed-cell";m.cellClasses=h;}else{if(h[f.field]){var c=h[f.field].split(" ");var d="";
for(var e=0;e<c.length;e++){if(c[e]!=="ui-changed-cell"){d+=(" "+c[e]);}}m.cellClasses[f.field]=d;}}for(var e=0;e<f.formatters.length;e++){k=f.formatters[e].call(this,j,g,k,f,m,l);}return k;},_removeFromClassList:function(e,h){var c=h.split(" ");var f=e.split(" ");var g="";for(var d=0;d<f.length;d++){if(a.inArray(f[d],c)===-1){g+=f[d]+" ";
}}return g.trim();},_toggleColumnAttributesDisabled:function(c,e){var g=this.options.columns;for(var f=0;f<g.length;f++){var h=g[f];for(var d=0;d<c.length;d++){var k=c[d];if(e&&h[k]){h[k]=false;h[k+"Disabled"]=true;}else{if(h[k+"Disabled"]){h[k]=true;h[k+"Disabled"]=false;}}}}},_setOption:function(c,d){a.Widget.prototype._setOption.apply(this,arguments);
this.grid.setOptions(this.options);switch(c){case"showHeaderRow":this.grid.setHeaderRowVisibility(d&&d!=="false");break;}},getSlickGrid:function(){return this.grid;},cancelCurrentEdit:function(){var c=this.grid.getEditorLock();if(c.isActive()){c.cancelCurrentEdit();}},saveCurrentEdit:function(){var c=this.grid.getEditorLock();
if(c.isActive()){c.commitCurrentEdit();}},setRowCssClass:function(e,c){var d=this.getItem(e);if(d){d.cssClasses=c;this.grid.invalidate();}},removeRowCssClass:function(e,c){var d=this.getItem(e);if(d&&d.cssClasses){this.setRowCssClass(e,this._removeFromClassList(d.cssClasses,c));this.grid.invalidate();
}},setCellCssClasses:function(c){if(c&&c.length){for(var e=0;e<c.length;e++){var f=c[e];var g=this.getItem(f.rowKey);if(g){var d=g.cellClasses?g.cellClasses:{};a.extend(d,f.cellClasses);g.cellClasses=d;}}this.grid.invalidate();}},addCellCssClass:function(f,d,c){var e=this.getCellCssClass(f,d);e+=" "+c;
this.setCellCssClass(f,d,e.trim());this.grid.invalidate();},removeCellCssClass:function(f,d,c){var e=this.getCellCssClass(f,d);if(e){this.setCellCssClass(f,d,this._removeFromClassList(e,c));this.grid.invalidate();}},getCellCssClass:function(f,c){var d="";var e=this.getItem(f);if(e){d=e.cellClasses?e.cellClasses[c]:d;
}return d;},setCellCssClass:function(g,d,c){var f=this.getItem(g);if(f){var e={};e[d]=c;this.setCellCssClasses([{rowKey:g,cellClasses:e}]);}},clearCellCssClass:function(d,c){this.setCellCssClass(d,c,"");},getItem:function(c){return this.dataHash[c];},setItem:function(d,c){this.dataHash[d]=c;this.dataView.updateItem(d,c);
this.grid.invalidate();},getItems:function(e){var c=[];for(var d=0;d<e.length;d++){c.push(this.dataHash[e[d]]);}return c;},replaceItem:function(e,d){delete this.dataHash[e];this.dataHash[d.id]=d;var c=this.dataView.getRowById(e);this.dataView.insertItem(c,d);this.dataView.deleteItem(e);this.grid.invalidate();
},isItemChanged:function(f){var c=false;var d=this.getItem(f);if(d&&d.changedCells){for(var e in d.changedCells){c=true;break;}}return c;},getOriginalValue:function(c,d){var m=this.getItem(c);var l=m[d];if(m&&m.changedCells){var k=this.getChanges();for(var f=0;f<k.length;f++){var h=k[f];if(h[this.options.rowKey]===c){for(var e=0;
e<h.changes.length;e++){var g=h.changes[e];if(g.field==d){l=g.oldValue;break;}}}}}return l;},markItemChanged:function(h,d,c){var e=this.getItem(h);var f=e.changedCells&&e.changedCells[d]!==b;if(!f){var g={};g[d]=c;a.extend(true,e,{"changedCells":g});}this.grid.invalidate();},getChanges:function(){var d=[];
for(var c=0;c<this.options.data.length;c++){var e=this.options.data[c];if(e.changedCells){var f=[];for(var g in e.changedCells){f.push({"field":g,"oldValue":e.changedCells[g],"newValue":e[g]});}if(f.length>0){var h={"changes":f};h[this.options.rowKey]=e[this.options.rowKey];d.push(h);}}}return d;},getChangedItems:function(){var c=[];
for(var d=0;d<this.options.data.length;d++){var e=this.options.data[d];if(e.changedCells){for(var f in e.changedCells){var g=a.extend(true,{},e);delete g.cssClasses;delete g.changedCells;delete g.cellClasses;c.push(g);break;}}}return c;},clearItemChanges:function(e){for(var c=0;c<this.options.data.length;
c++){var d=this.options.data[c];if(d[this.options.rowKey]==e){delete d.changedCells;break;}}this.grid.invalidate();},clearChangedItems:function(){for(var c=0;c<this.options.data.length;c++){var d=this.options.data[c];if(d.changedCells){delete d.changedCells;}}this.grid.invalidate();},disable:function(){a.Widget.prototype.disable.call(this);
this.options.editDisabled=this.options.editable;this.options.columnReorderDisabled=this.options.enableColumnReorder;this.options.editable=false;this.options.enableColumnReorder=false;this.grid.setOptions(this.options);this.element.find("div.slick-header-columns").sortable("disable");this._toggleColumnAttributesDisabled(["sortable","resizable"],true);
this.element.find("div.slick-headerrow-columns .ui-grid-filter").attr("disabled","disabled");this.element.find("div.slick-viewport").css("overflow-y","hidden");this.disabled=true;this.grid.invalidate();this._trigger("disable");},enable:function(){a.Widget.prototype.enable.call(this);this.options.editable=this.options.editDisabled;
this.options.enableColumnReorder=this.options.columnReorderDisabled;this.grid.setOptions(this.options);if(this.options.enableColumnReorder){this.element.find("div.slick-header-columns").sortable("enable");}this._toggleColumnAttributesDisabled(["sortable","resizable"],false);this.element.find("div.slick-headerrow-columns .ui-grid-filter").removeAttr("disabled");
this.element.find("div.slick-viewport").css("overflow-y","auto");this.disabled=false;this.grid.invalidate();this._trigger("enable");},destroy:function(){this.grid.onColumnsReordered.unsubscribe();this.grid.onColumnsResized.unsubscribe();this.grid.destroy();this.element.removeClass("ui-grid ui-widget").unbind().empty();
a.Widget.prototype.destroy.call(this);}});})(jQuery);